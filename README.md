# Boat Scanner

Scan and extract single-boat LiDAR point clouds from rosbag streams using YOLO 2D detections, with optional PointPillars feature extraction and an offline viewer.

### Features
- 2D detection-assisted filtering of LiDAR point clouds (YOLO-based)
- PointPillars feature extraction for boat clusters
- Dataset builder that saves per-object point clouds and images
- Simple offline visualizer to inspect results

## 1) Prerequisites
- Ubuntu + ROS (tested on typical catkin setups; source your ROS environment)
- Python 3 with numpy, OpenCV, matplotlib, rospkg
- GPU + PyTorch if using PointPillars feature extraction (CUDA required)

Example (Python deps):
```
pip install numpy opencv-python matplotlib rospkg
```

## 2) Setup
```
git clone https://github.com/ldw200012/Boat_Scanner.git
cd Boat_Scanner
catkin_make
source devel/setup.bash   # or setup.zsh
```

## 3) Quick Start
1. Play a rosbag that contains synchronized camera and LiDAR topics:
```
rosbag play YOUR_CAMERA_LIDAR.bag
```
2. Launch the scanner node:
```
roslaunch vessel_pointcloud_scanner vessel_pointcloud_scanner.launch
```

This will run the pipeline that fuses YOLO detections with LiDAR to isolate boat point clouds.

## 4) Build a Dataset (optional)
Use the PointPillars-based extractor to save per-object data.

1. Edit the target class/index in the script before running:
   - File: `src/pillars_feature_extractor/scripts/create_dataset.py`
   - Line: `113` â†’ change the argument passed to `PointPillarNode("0008")`
     to the class or folder index you want to save under.

2. Run the extractor while your rosbag/pipeline is active:
```
cd src/pillars_feature_extractor/scripts
python3 create_dataset.py
```

Outputs will be saved under:
- `src/pillars_feature_extractor/dataset/{CLASS_INDEX}/`

Note: This script loads a PointPillars checkpoint and uses CUDA. Ensure your PyTorch/CUDA match the prebuilt ops. If you encounter import errors in `ops/`, rebuild or align the environment accordingly.

## 5) Offline Data Viewer
After collecting samples, visualize them:
```
python3 src/vessel_pointcloud_scanner/scripts/data_viewer.py
```
The viewer scans `vessel_pointcloud_scanner/data/object/*/` for:
- `pts_raw.bin` (float32 XYZ[I])
- `pts_xyz.bin` (cluster points)
- `img_det.png` (detection image)

It saves composites into `vessel_pointcloud_scanner/data/viewer/` as PNGs.

## 6) Tips & Troubleshooting
- Always `source devel/setup.bash` before running `roslaunch` or Python scripts that rely on ROS packages.
- If `rospack` cannot find a package, verify you built in the workspace root and sourced the workspace.
- For PointPillars CUDA ops: ensure GPU drivers, CUDA toolkit, and PyTorch versions are compatible.

## 7) Repository Layout (key parts)
```
Boat_Scanner/
  src/
    vessel_pointcloud_scanner/           # ROS package for scanning/launch
      launch/vessel_pointcloud_scanner.launch
      scripts/data_viewer.py
      data/object/<id>/{pts_raw.bin, pts_xyz.bin, img_det.png}
      data/viewer/*.png                  # generated by data_viewer.py
    pillars_feature_extractor/           # PointPillars + dataset tools
      scripts/create_dataset.py
      dataset/<class_idx>/               # dataset output
```

---

If you run into issues, please open an issue with your ROS version, CUDA/PyTorch versions (if applicable), and a short log snippet.